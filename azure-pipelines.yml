# Python package

# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- master

pool:
  vmImage: ubuntu-latest
strategy:
  matrix:
    Python37:
      python.version: '3.7'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(python.version)'
  displayName: 'Use Python $(python.version)'

- task: ksmazpipelinehello1@0
  inputs:
    keepersecretconfig: '{"appKey":"8Kx25SvtkRSsEYIur7mHKtLqANFNB7AZRa9cqi2PSQE=","clientId":"4H\/U5J6DcfKLYBIIAV5YwEFG4n3XhiDvNtoPkmSMITeTNZsa\/EJ0zTbpACRtmNUBRH+NvR+24sQhU9uGjLTZHw==","hostname":"keepersecurity.com","privateKey":"MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQguhzDI4iVS5Bw9l5cffFXpP+FhulNH41GDWVcsbgXyiOhRANCAATk1fzoL8\/VLpuYuu13wElPNp3aG2glFkEPzxaiMgP+vtUd4gZ23TpGu1s1tqKaEe9h7VCVMjwvDA31anfMlYF5","serverPublicKeyId":"10"}'
    secrets: |
      6ya_fdc6XTsZ7i7x9Jcodg/field/password > env:PASSWORD
      6ya_fdc6XTsZ7i7x9Jcodg/field/login > LOGIN
      6ya_fdc6XTsZ7i7x9Jcodg/file/build-vsix.sh > file:/tmp/build-vsix.sh

- script: |
    ls -la /tmp
  displayName: 'Listing files in /tmp directory'

- script: |
    env
  displayName: 'Listing env'

- script: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt
  displayName: 'Install dependencies'

- script: |
    pip install pytest pytest-azurepipelines
    pytest
  displayName: 'pytest'
